<?php 	//********************	//** WEB MIRACLE TECHNOLOGIES	//********************		// get post		$appTable = $_POST['appTable'];		$item_id = (isset($_POST['item_id']) ? $_POST['item_id'] : 0);		$cardUpd = array(					'alias'			=> $_POST['alias'],					'location'		=> $_POST['location'],					'name'			=> $_POST['name'],					'desc'			=> $_POST['desc'],					'desc_full'		=> $_POST['desc_full'],					'deadline'		=> date('Y-m-d H:i:s', strtotime($_POST['deadline'].' 00:00:00')),					'moderation'	=> (int)$_POST['moderation'][0],					'user_id'		=> (int)$_POST['user_id'],					'status'		=> (int)$_POST['status'],					'modified'	=> date("Y-m-d H:i:s", time()),					'created'	=> date("Y-m-d H:i:s", time()),					);						if(strlen($cardUpd['name'])>1)	{		if(!$test_alias)		{			$filename = "cover";			if(isset($_FILES[$filename]) && $_FILES[$filename]['size'] > 0)			{				$file_path = "../../../../webroot/img/covers/";								$file_update = $ah->mtvc_add_files_file(array(						'path'			=>$file_path,						'name'			=>5,						'pre'			=>"cover_",						'size'			=>10,						'rule'			=>0,						'max_w'			=>2500,						'max_h'			=>2500,						'files'			=>$filename					  ));				if($file_update)				{					$cardUpd[$filename] = $file_update;				}			}			// Create main table item						$query = "INSERT INTO [pre]$appTable ";						$fieldsStr = " ( ";						$valuesStr = " ( ";						$cntUpd = 0;			foreach($cardUpd as $field => $itemUpd)			{				$cntUpd++;								$fieldsStr .= ($cntUpd==1 ? "`$field`" : ", `$field`");								$valuesStr .= ($cntUpd==1 ? "'$itemUpd'" : ", '$itemUpd'");			}						$fieldsStr .= " ) ";						$valuesStr .= " ) ";						$query .= $fieldsStr." VALUES ".$valuesStr;							$item_id = $ah->dbh->q($query,0,1,1);						if($item_id)			{				$data['item_id'] = $item_id;				$data['status'] = "success";				$data['message'] = "Новая проблема успешно создана.";									$filename = "files";				if(isset($_FILES[$filename]) && count($_FILES[$filename]) > 0)				{					$file_path = "../../../../webroot/uploads/";					$files_upload = $ah->mtvc_add_files_file_miltiple(array(							'path'			=>$file_path,							'name'			=>5,							'pre'			=>"upd_",							'size'			=>10,							'rule'			=>0,							'max_w'			=>2500,							'max_h'			=>2500,							'files'			=>$filename,							'resize_path'	=>$file_path."crop/",							'resize_w'		=>600,							'resize_h'		=>600,							'resize_path_2'	=>"0",							'resize_w_2'	=>0,							'resize_h_2'	=>0						  ));					if($files_upload)					{						$now = date("Y-m-d H:i:s");						foreach($files_upload as $file_upload)						{							$extP = explode('.', $file_upload);							$ext = end($extP);							$query = "INSERT INTO [pre]problems_files (`problem_id`, `filename`, `ext`, `created`) VALUES ('$item_id', '$file_upload', '$ext', '$now')";							$ah->rs($query);						}					}				}							}else			{				$data['item_id'] = 0;			}				}else{			$data['status'] = "failed";			$data['message'] = "Проблема с таким алиасом уже существует";		}	}else{		$data['status'] = "failed";		$data['message'] = "Укажите название проекта";		}	